<!DOCTYPE html>
<html lang="es">
 <head>
  <!-- Microsoft -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "rsr4k41i5m");
</script>

  <!-- SDK de PayPal -->
  <script src="https://www.paypal.com/sdk/js?client-id=AbKjstKstdPQSR9L0KG7z8i-01pBzt36YaHBQMqhs3dBuNhWNffCg9uktEgJ_KhT7R_Y4rWPHkt4P_Dl&currency=USD"></script>
  <script>
    function renderPayPalButton(pack, usdAmount) {
      paypal.Buttons({
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              description: `${pack} Cr√©ditos - PigmentaLab`,
              amount: { value: usdAmount.toFixed(2) }
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert(`‚úÖ Pago completado con PayPal por ${details.payer.name.given_name}`);

            const user = firebase.auth().currentUser;
            if (!user) {
              alert("‚ö†Ô∏è No se pudo obtener el usuario. No se registr√≥ el pago.");
              return;
            }

            const fd = new FormData();
            fd.append('email', user.email);
            fd.append('credits', pack);
            fd.append('amount', usdAmount);

            fetch("paypal_registro_creditos.php", {
              method: "POST",
              body: fd
            })
            .then(r => r.json())
            .then(res => {
              if (res.success) {
                alert("üéâ Cr√©ditos cargados correctamente.");
                actualizarCreditos(user.email);
              } else {
                alert("‚ö†Ô∏è Error al registrar cr√©ditos: " + res.mensaje);
              }
            })
            .catch(err => {
              console.error("‚ùå Error en backend:", err);
              alert("‚ùå Ocurri√≥ un error al registrar los cr√©ditos.");
            });
          });
        },
        onError: function(err) {
          console.error("‚ùå Error en PayPal:", err);
          alert("Ocurri√≥ un error con PayPal.");
        }
      }).render(`#paypal-button-container-${pack}`);
    }

    renderPayPalButton(10, 2.00);
    renderPayPalButton(150, 15.00);
    renderPayPalButton(500, 40.00);
  </script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-0810ZNG3PL');
  </script>

  <meta content="editor DTF, quitar fondo, mejorar im√°genes, semitono, impresi√≥n textil, IA para dise√±o, PigmentaLab" name="keywords"/>
  <meta content="Editor IA DTF para mejorar im√°genes, quitar fondo, aplicar efectos semitono, calado art√≠stico y m√°s. Ideal para impresi√≥n textil." name="description"/>
  <meta content="Editor IA DTF - PigmentaLab" property="og:title"/>
  <meta content="Mejor√° tus im√°genes, elimin√° fondos y gener√° semitonos de alta calidad con inteligencia artificial para impresi√≥n textil." property="og:description"/>
  <meta content="https://pigmentalab.io/img/editor-cover.jpg" property="og:image"/>
  <meta content="http://pigmentalab.io:8080/" property="og:url"/>
  <meta content="website" property="og:type"/>
  <meta charset="utf-8"/>
  <meta content="7NEdZuY2KRw1_5T5IMzy6IPy9yqdwf9K4wovua8TRIE" name="google-site-verification"/>

  <title>Editor Mejorador de Imagenes con Ineligencia Artificial</title>

  <!-- Firebase SDK para apps sin bundler (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script>
    // Configuraci√≥n de tu proyecto Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDiN6yJajiZv08LRpA_bC1nfTTmsJRivvU",
      authDomain: "pigmentalab-6ce72.firebaseapp.com",
      projectId: "pigmentalab-6ce72",
      storageBucket: "pigmentalab-6ce72.appspot.com",
      messagingSenderId: "206056684664",
      appId: "1:206056684664:web:d12b82e43329fd92b7c18d",
      measurementId: "G-0810ZNG3PL"
    };
    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
  </script>

  <script>
    function validarAlto() {
      const input = document.getElementById("alto_cm");
      const error = document.getElementById("errorAlto");
      if (parseFloat(input.value) > 100) {
        error.style.display = "block";
        input.setCustomValidity("No pod√©s superar los 100 cm sin suscripci√≥n.");
      } else {
        error.style.display = "none";
        input.setCustomValidity("");
      }
    }
  </script>

  <script>
    // 1) Variable global para guardar el correo del usuario logueado
    let usuarioEmail = null;

    // 2) Cuando cambie el estado de auth, actualizo usuarioEmail
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        usuarioEmail = user.email;
        document.getElementById("userEmail").innerText = `üë§ ${usuarioEmail}`;
      } else {
        usuarioEmail = null;
        document.getElementById("userEmail").innerText = `PigmentaLab.io`;
      }
    });

    // 3) Mapeo precios (si quer√©s cambiar montos seg√∫n pack)
    const precioMap = {
      10: 900,
      150: 8750,
      500: 19500
    };

    // 4) Funci√≥n para generar link POST a createPreferenceMP.php
    async function comprarCreditos(cantidad) {
      if (!usuarioEmail) {
        return alert("Deb√©s iniciar sesi√≥n para comprar cr√©ditos.");
      }
      const amount = precioMap[cantidad] || 0;
      if (amount <= 0) {
        return alert("Pack inv√°lido.");
      }

      try {
        const resp = await fetch("https://pigmenta.digitaltex.com.ar/createPreferenceMP.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: usuarioEmail,
            credits: cantidad,
            amount: amount
          })
        });
        const data = await resp.json();
        if (data.init_point) {
          window.open(data.init_point, "_blank");
        } else {
          console.error("Error al generar link:", data);
          alert("No se pudo generar el link de pago.");
        }
      } catch (e) {
        console.error("Error de red:", e);
        alert("Fallo de red al generar el link de pago.");
      }
    }

    // 5) Atar los botones existentes
    document.querySelectorAll("#comprarCreditos button").forEach(btn => {
      btn.addEventListener("click", () => {
        const pack = parseInt(btn.getAttribute("data-pack"), 10);
        comprarCreditos(pack);
      });
    });
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Editor IA DTF - PigmentaLab",
      "operatingSystem": "Web",
      "applicationCategory": "ImageEditor",
      "description": "Editor IA DTF para eliminar fondo, mejorar calidad y aplicar semitono en im√°genes para impresi√≥n textil.",
      "browserRequirements": "Requires JavaScript",
      "author": {
        "@type": "Organization",
        "name": "PigmentaLab"
      },
      "url": "http://pigmentalab.io:8080/",
      "image": "https://pigmentalab.io/img/editor-cover.jpg"
    }
  </script>

  <style>
    .user-profile {
      width: 131px;
      height: 51px;
      border-radius: 15px;
      cursor: pointer;
      transition: 0.3s ease;
      background: linear-gradient(
        to bottom right,
        #2e8eff 0%,
        rgba(46, 142, 255, 0) 30%
      );
      background-color: rgba(46, 142, 255, 0.2);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: none;
      padding: 0;
    }

    .user-profile:hover,
    .user-profile:focus {
      background-color: rgba(46, 142, 255, 0.7);
      box-shadow: 0 0 10px rgba(46, 142, 255, 0.5);
      outline: none;
    }

    .user-profile-inner {
      width: 127px;
      height: 47px;
      border-radius: 13px;
      background-color: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: #fff;
      font-weight: 600;
      font-family: sans-serif;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #121212;
      color: #fff;
      display: flex;
      height: 100vh;
    }

    /* Overlay para m√≥viles */
    #mobileWarning {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: #000;
      color: #00ffff;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      padding: 20px;
      z-index: 9999;
    }

    /* Contenedor de la app */
    #appContent {
      display: flex;
      flex: 1;
    }

    .sidebar {
      width: 220px;
      background-color: #1e1e1e;
      padding-top: 20px;
      border-right: 2px solid #00ffff;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar a {
      text-decoration: none;
      color: #00ffff;
      font-weight: bold;
      margin: 10px 0;
      display: block;
      width: 90%;
      text-align: center;
      padding: 10px;
      border-radius: 6px;
    }

    .sidebar a:hover {
      background-color: #00ffff;
      color: #000;
    }

    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .tab-content {
      display: none;
      background-color: #1e1e1e;
      padding: 30px;
      max-width: 500px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,255,255,0.2);
    }

    .tab-content.active {
      display: block;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
    }

    button {
      background-color: #00ffff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    #descargaAmplia,
    #descargaFondo,
    #descargaHalftone,
    #descargaMejorada,
    #descargaCalado {
      display: none;
      margin-top: 20px;
    }

    #loaderOverlay {
      display: none;
      position: fixed;
      z-index: 999;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .loader {
      border: 8px solid #1e1e1e;
      border-top: 8px solid #00ffff;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    #loaderText {
      margin-top: 15px;
      font-size: 16px;
      color: #00ffff;
    }

    #topBar button:hover {
      background-color: #00ffff;
      color: #000;
    }

    .form-container {
      background: linear-gradient(#212121, #212121) padding-box,
                  linear-gradient(120deg, transparent 25%, #1cb0ff, #40ff99) border-box;
      border: 2px solid transparent;
      padding: 32px 24px;
      font-size: 14px;
      color: white;
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-sizing: border-box;
      border-radius: 16px;
    }

    .heading {
      font-size: 20px;
      font-weight: 600;
      text-align: center;
    }

    .form {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    button {
      border-radius: 5px;
      padding: 6px 12px;
      background: #ffffff14;
      color: #c7c5c5;
      border: 1px solid #414141;
      transition: background 0.3s;
    }

    button:hover {
      background: #212121;
      cursor: pointer;
    }

    .input {
      font-family: 'Segoe UI', sans-serif;
      margin: 1em 0 1em 0;
      max-width: 190px;
      position: relative;
    }

    .input input {
      font-size: 100%;
      padding: 0.8em;
      outline: none;
      border: 2px solid rgb(141, 109, 255);
      background-color: transparent;
      border-radius: 20px;
      width: 100%;
    }

    .input label {
      font-size: 100%;
      position: absolute;
      left: 0;
      padding: 0.8em;
      margin-left: 0.5em;
      pointer-events: none;
      transition: all 0.3s ease;
      color: rgb(255, 255, 255);
    }

    .input :is(input:focus, input:valid) ~ label {
      transform: translateY(-50%) scale(.9);
      margin: 0em;
      margin-left: 1.3em;
      padding: 0.4em;
      background-color: #212121;
    }

    .inputGroup :is(input:focus, input:valid) {
      border-color: rgb(37, 37, 211);
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      max-width: 1000px;
      width: 100%;
      padding: 20px;
      justify-items: center;
      margin: 0 auto;
    }

    .card {
      background: linear-gradient(#212121, #212121) padding-box,
                  linear-gradient(120deg, transparent 25%, #1cb0ff, #40ff99) border-box;
      border: 2px solid transparent;
      border-radius: 16px;
      padding: 20px;
      color: white;
      font-size: 1em;
      width: 100%;
      max-width: 300px;
      text-align: center;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card img {
      width: 100%;
      border-radius: 8px;
      margin-top: 10px;
      object-fit: cover;
      height: auto;
    }

    .card h2 {
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    .card p {
      margin-bottom: 10px;
    }

    .button {
      cursor: pointer;
      font-size: 1.2rem;
      border-radius: 16px;
      border: none;
      padding: 2px;
      background: radial-gradient(circle 80px at 80% -10%, #ffffff, #181b1b);
      position: relative;
      display: inline-block;
      margin-top: 10px;
    }

    .button::after {
      content: "";
      position: absolute;
      width: 65%;
      height: 60%;
      border-radius: 120px;
      top: 0;
      right: 0;
      box-shadow: 0 0 20px #ffffff38;
      z-index: -1;
    }

    .blob1 {
      position: absolute;
      width: 70px;
      height: 100%;
      border-radius: 16px;
      bottom: 0;
      left: 0;
      background: radial-gradient(circle 60px at 0% 100%, #3fe9ff, #0000ff80, transparent);
      box-shadow: -10px 10px 30px #0051ff2d;
      z-index: -2;
    }

    .inner {
      padding: 14px 25px;
      border-radius: 14px;
      color: #fff;
      z-index: 3;
      position: relative;
      background: radial-gradient(circle 80px at 80% -50%, #777777, #0f1111);
      transition: transform 0.2s ease;
    }

    .inner::before {
      content: "";
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      border-radius: 14px;
      background: radial-gradient(circle 60px at 0% 100%, #00e1ff1a, #0000ff11, transparent);
      position: absolute;
    }

    .button:hover .inner {
      transform: scale(1.05);
    }

    /* Bot√≥n circular con tooltip y animaciones */
    .Btn {
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 50%;
      background-color: rgb(27, 27, 27);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: background-color .3s, box-shadow .3s;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.11);
    }

    .svgIcon {
      fill: rgb(214, 178, 255);
      transition: fill .3s;
    }

    .icon2 {
      width: 18px;
      height: 5px;
      border-bottom: 2px solid rgb(182, 143, 255);
      border-left: 2px solid rgb(182, 143, 255);
      border-right: 2px solid rgb(182, 143, 255);
      transition: border-color .3s;
    }

    .tooltip {
      position: absolute;
      right: calc(100% + 10px);
      white-space: nowrap;
      opacity: 0;
      background-color: rgb(12, 12, 12);
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      transition: opacity .2s;
      font-size: 0.85rem;
    }

    .tooltip::before {
      content: "";
      position: absolute;
      width: 10px; height: 10px;
      background-color: rgb(12, 12, 12);
      transform: rotate(45deg);
      left: -5px;
      top: 50%;
      transform: translateY(-50%) rotate(45deg);
    }

    .Btn:hover .tooltip {
      opacity: 1;
    }

    .Btn:hover {
      background-color: rgb(150, 94, 255);
    }

    .Btn:hover .icon2 {
      border-color: rgb(235, 235, 235);
    }

    .Btn:hover .svgIcon {
      fill: #fff;
      animation: slide-in-top 0.6s cubic-bezier(0.25,0.46,0.45,0.94) both;
    }

    @keyframes slide-in-top {
      0% {
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
 </head>

 <body>
  <!-- Mensaje para m√≥viles -->
  <!-- <div id="mobileWarning">
       <div style="font-size:60px;">üíª</div>
       <h1>Solo disponible en computadoras</h1>
       <p>Acced√© desde una PC o Notebook para ingresar a la experiencia de PigmentaLAB.io</p>
     </div> -->

  <!-- HEADER -->
  <div id="topBar" style="
        position: fixed; top: 0; left: 0;
        width: 100%; height: 40px;
        background: #000; border-bottom: 2px solid #00FFFF;
        color: #00FFFF; display: flex; align-items: center;
        justify-content: flex-end; padding: 0 24px;
        font-family: 'Segoe UI', sans-serif; font-size: 14px;
        z-index: 10000;
      ">
    <div id="userMenu" style="position: relative;">
      <span id="userEmail" style="cursor: pointer; font-weight: 600; margin-right: 8px;">
        PigmentaLab.io
      </span>
      <span id="userMenuToggle" style="cursor: pointer; font-weight: 600;">
        ‚ñº
      </span>
      <div id="dropdown" style="
            display: none; position: absolute;
            top: 44px; right: 0;
            background: #1e1e1e; border: 2px solid #00FFFF;
            border-radius: 8px; overflow: hidden;
            min-width: 220px; box-shadow: 0 4px 12px rgba(0,255,255,0.2);
            z-index: 10001;
          ">
        <div id="userEmailDisplay" style="
              padding: 12px 16px; border-bottom: 1px solid #00FFFF;
              color: #00FFFF; font-weight: 600; background: #111;
            ">
          PigmentaLab.io
        </div>

        <!-- Secci√≥n de Compra de Cr√©ditos -->
        <div id="comprarCreditos" style="
              margin-top: 40px; padding: 20px; background: #111; border-top: 2px solid #00FFFF; text-align: center;
            ">
          <h2 style="color: #00FFFF; font-family: 'Segoe UI'; margin-bottom: 20px;">
            üí≥ Eleg√≠ tu Pack de Cr√©ditos
          </h2>
          <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 24px;">
            <div style="text-align:center; margin-top: 30px;">
              <button onclick="mostrarTab('comprar')">Comprar 10 Cr√©ditos</button>
              <button onclick="mostrarTab('comprar')">Comprar 150 Cr√©ditos</button>
              <button onclick="mostrarTab('comprar')">Comprar 500 Cr√©ditos</button>
            </div>
          </div>
        </div>

        <button onclick="logout()" style="
              width: 100%; padding: 12px 16px;
              background: none; border: none;
              color: #00FFFF; font-weight: 600;
              cursor: pointer; text-align: center;
              transition: background 0.2s;
            " onmouseover="this.style.background='rgba(0,255,255,0.1)'" onmouseout="this.style.background='none'">
          üîì Cerrar sesi√≥n
        </button>
      </div>
    </div>
  </div>

  <!-- Contenedor principal de la app -->
  <div id="appContent" style="padding-top: 20px;">
    <!-- Google Login obligatorio -->
    <script>
      firebase.auth().onAuthStateChanged(user => {
        if (!user) {
          // Crea un header de login y lo agrega al body
          const loginBar = document.createElement('div');
          loginBar.id = 'loginHeader';
          loginBar.innerHTML = `
<div style="
  width: 100%;
  background: linear-gradient(120deg, #00ffff, #8a2be2);
  color: white;
  padding: 3px 2px 15px 2px;
  text-align: center;
  font-family: 'Segoe UI', sans-serif;
  box-shadow: 0 2px 16px rgba(0, 255, 255, 0.3);
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1000;
  border-bottom: 2px solid #00ffff;
">
  <!-- Logo -->
  <img src="este.png" alt="PigmentaLab Logo" style="
    height: 90px;
    margin-top: 20px;
    margin-bottom: 5px;
    filter: drop-shadow(0 0 6px rgba(0,0,0,0.4));
  ">

  <p style="margin-bottom: 15px; font-size: 1rem; color: #f0f0f0; text-shadow: 0 0 40px rgba(0,0,0,0.4);">
    Ingresa a PigmentaLab, Inicia sesi√≥n ‚Äî <strong>Registrate al (BETA 1.0)</strong>
  </p>

  <!-- Bot√≥n con estilo compacto -->
  <button onclick="loginConGoogle()" style="
    display: inline-block;
    padding: 12px 24px;
    font-size: 1rem;
    border-radius: 12px;
    border: none;
    background: #000;
    color: #00ffff;
    cursor: pointer;
    box-shadow:
      0 0 10px #00ffffaa,
      inset 0 0 10px #00ffff55;
    transition: transform 0.2s ease;
  " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
    üîê Iniciar sesi√≥n con Google
  </button>
</div>

<div style="
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 200px 75px;
  max-width: 1200px;
  margin: auto;
">
<!-- Estilos de los cards -->
<style>
  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    justify-content: center;
    padding: 0 20px;
  }

  .card {
    background: linear-gradient(#212121, #212121) padding-box,
                linear-gradient(120deg, transparent 25%, #1cb0ff, #40ff99) border-box;
    border: 2px solid transparent;
    border-radius: 16px;
    padding: 20px;
    color: white;
    text-align: center;
    box-sizing: border-box;
    max-width: 100%;
    transition: transform 0.2s ease;
  }

  .card:hover {
    transform: scale(1.03);
  }

  .card h2 {
    font-size: 1.2rem;
    margin-bottom: 10px;
  }

  .card p {
    font-size: 1rem;
    margin-bottom: 10px;
  }

  .card img {
    width: 100%;
    border-radius: 8px;
    margin-top: 10px;
    object-fit: cover;
  }
</style>

<!-- Contenido -->
<div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px; text-align: center;">
  <h1 style="margin-bottom: 10px;">Editor DTF con Herramientas Profesionales</h1>
  <p style="max-width: 700px; margin: 0 auto 40px;">
    Descubr√≠ nuestras herramientas dise√±adas para mejorar tus dise√±os y prepararlos para impresi√≥n textil de alta calidad.
  </p>

  <div class="card-grid">

    <!-- CARD CON EFECTO -->
    <div onclick="loginConGoogle()"
         class="card group relative"
         style="background-image: url('lab.png'); background-size: cover; background-position: center; position: relative; overflow: hidden; width: 320px; height: 350px; padding: 20px; border-radius: 8px; display: flex; flex-direction: column; color: white;">

      <!-- Efecto de borde animado -->
      <div class="absolute inset-0 border-2 border-transparent rounded-md group-hover:border-cyan-400 transition-all duration-500 z-[1] pointer-events-none"></div>

      <!-- Capa oscura encima de la imagen para contraste -->
      <div style="position: absolute; inset: 0; background: rgba(0, 0, 0, 0.6); z-index: 0; border-radius: 8px;"></div>

      <!-- Contenido de la card -->
      <div class="main-content relative z-10 flex flex-col justify-center items-center text-center space-y-4 h-full">
        <h2 class="text-2xl font-extrabold text-cyan-300 leading-tight">
          INGRES√Å<br>AC√Å
        </h2>

        <p class="text-sm text-gray-200">Empez√° a crear tus im√°genes personalizadas en segundos.</p>

        <div class="mt-4 w-full bg-gradient-to-r from-purple-600 via-pink-500 to-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:opacity-90 transition">
          Continuar con Google
        </div>
      </div>
    </div>

    <!-- OTRAS CARDS NORMALES -->
    <a href="mejorar.html" class="card hover:scale-105 transition-transform duration-200">
      <h2>üìè Mejora la calidad de tus Im√°genes</h2>
      <p>Aument√° resoluci√≥n a 300 DPI y convert√≠ tus archivos en cent√≠metros reales para impresi√≥n.</p>
      <img src="https://descubrecomohacerlo.com/wp-content/uploads/mch/editar-imagen-mejorar-calidad_9137.jpg" alt="Mejorar calidad">
    </a>

    <div class="card">
      <h2>üñ®Ô∏è Optimizaci√≥n 300 DPI</h2>
      <p>Logr√° resultados listos para producci√≥n con resoluci√≥n profesional.</p>
      <img src="https://canonbcn22.b-cdn.net/wp-content/uploads/71-71-imageprograf-ipf-pro-4000-canon-plotter.v1-1200x597.jpg" alt="300 DPI">
    </div>

    <a href="quitarfondo.html" class="card hover:scale-105 transition-transform duration-200">
      <h2>üßΩ Eliminar Fondo Autom√°ticamente</h2>
      <p>Quitar fondo sin esfuerzo en tus dise√±os PNG con IA avanzada.</p>
      <img src="https://i0.wp.com/imgs.hipertextual.com/wp-content/uploads/2020/03/hipertextual-elimina-fondo-cualquier-video-gif-con-simple-clic-2020751024.jpg" alt="Quitar fondo">
    </a>

    <div class="card">
      <h2>üé® Efecto Semitono</h2>
      <p>Convert√≠ tus im√°genes en tramas listas para imprimir en DTF de alta definici√≥n.</p>
      <img src="https://i.ytimg.com/vi/HSbHEWOLgSc/maxresdefault.jpg" alt="Semitono">
    </div>

    <div class="card">
      <h2>üåë Fondo Negro Inteligente</h2>
      <p>Elimin√° fondo oscuro para estampar sobre prendas negras sin errores.</p>
      <img src="https://i.blogs.es/e0d3cd/fondo-negro-portada/original.jpg" alt="Fondo negro">
    </div>

  </div>

  <!-- BOTONES ABAJO -->
  <div style="margin-top: 40px; display: flex; flex-direction: column; gap: 16px; align-items: center;">

    <!-- Bot√≥n Semitonos -->
    <a href="http://pigmentalab.io:8080/semitonos_adv.html" style="
      display: inline-block;
      padding: 12px 24px;
      font-size: 1rem;
      color: white;
      text-decoration: none;
      background: linear-gradient(120deg, #00ffff, #8a2be2);
      border: 2px solid transparent;
      border-radius: 12px;
      box-shadow:
          0 0 8px rgba(0, 255, 255, 0.5),
          0 0 16px rgba(138, 43, 226, 0.5),
          inset 0 0 8px rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;"
      onmouseover="this.style.transform='scale(1.05)';"
      onmouseout="this.style.transform='scale(1)';">
      üé® Probar Semitonos Avanzados
    </a>

    <!-- Bot√≥n Contacto -->
    <a href="http://pigmentalab.io:8080/contacto.html" style="
      display: inline-block;
      padding: 12px 24px;
      font-size: 1rem;
      color: white;
      text-decoration: none;
      background: linear-gradient(120deg, #ff00a8, #00ffff);
      border: 2px solid transparent;
      border-radius: 12px;
      box-shadow:
          0 0 8px rgba(255, 0, 168, 0.5),
          0 0 16px rgba(0, 255, 255, 0.5),
          inset 0 0 8px rgba(255, 255, 255, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;"
      onmouseover="this.style.transform='scale(1.05)';"
      onmouseout="this.style.transform='scale(1)';">
      üì© Contactanos
    </a>
  </div>
</div>

      `;
          document.body.prepend(loginBar);

          // Bloquear el resto de la app (si quer√©s ocultar el contenido mientras tanto)
          document.getElementById("appContent").style.display = "none";
        }
      });

      function loginConGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider)
          .then(result => {
            const user = result.user;

            // Llamar a tu backend para registrar el usuario
            fetch("registrar_usuario.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded"
              },
              body: new URLSearchParams({
                uid: user.uid,
                email: user.email,
                nombre: user.displayName || ''
              })
            })
            .then(r => r.text())
            .then(msg => {
              console.log("üì• Registro en base de datos:", msg);
              location.reload(); // Recargar luego del registro
            })
            .catch(err => {
              console.error("‚ùå Error al registrar en la base de datos:", err);
              location.reload(); // Igual recargar si falla
            });
          })
          .catch(e => {
            alert("Error al iniciar sesi√≥n: " + e.message);
          });
      }

      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          // Mostrar email en la barra superior
          const userEmail = document.getElementById("userEmail");
          userEmail.innerText = `üë§ ${user.email}`;
          userEmail.onclick = () => {
            const dropdown = document.getElementById("dropdown");
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
          };
        }
      });

      function logout() {
        firebase.auth().signOut().then(() => {
          location.reload();
        });
      }
    </script>

    <!-- Men√∫ lateral -->
    <div class="sidebar space-y-4 text-white">
      <!-- Logo PigmentaLab -->
      <div class="flex justify-center items-center pt-4 pb-4 bg-[#1e1e1e] shadow-md rounded-md mx-2">
        <a href="#" title="Inicio PigmentaLab">
          <img alt="PigmentaLab Logo" class="object-contain mx-auto transition-transform duration-300 hover:scale-105 hover:drop-shadow-[0_0_10px_#00FFFF]" src="este.png" style="height: 40px;"/>
        </a>
      </div>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('comprar')">
        <svg class="feather feather-credit-card" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
          <line x1="1" y1="10" x2="23" y2="10"></line>
        </svg>
        Mi Cuenta
      </a>

      <!-- Opciones del men√∫ -->
      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('ampliar')">
        <svg class="feather feather-zoom-in" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="11" x2="11" y1="8" y2="14"></line>
          <line x1="8" x2="14" y1="11" y2="11"></line>
          <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
        </svg>
        Ampliar Imagen
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('quitar')">
        <svg class="feather feather-scissors" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <circle cx="6" cy="6" r="3"></circle>
          <circle cx="6" cy="18" r="3"></circle>
          <line x1="20" x2="8.12" y1="4" y2="15.88"></line>
          <line x1="14.47" x2="20" y1="14.48" y2="20"></line>
        </svg>
        Quitar Fondo
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('quitarAdv')">
        <svg class="feather feather-layers" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
          <polyline points="2 17 12 22 22 17"></polyline>
          <polyline points="2 12 12 17 22 12"></polyline>
        </svg>
        Quitar Fondo Avanzado
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('halftone')">
        <svg fill="currentColor" height="20" viewBox="0 0 24 24" width="20">
          <circle cx="4" cy="4" r="2"></circle>
          <circle cx="12" cy="4" r="2"></circle>
          <circle cx="20" cy="4" r="2"></circle>
          <circle cx="4" cy="12" r="2"></circle>
          <circle cx="12" cy="12" r="2"></circle>
          <circle cx="20" cy="12" r="2"></circle>
          <circle cx="4" cy="20" r="2"></circle>
          <circle cx="12" cy="20" r="2"></circle>
          <circle cx="20" cy="20" r="2"></circle>
        </svg>
        Semitono
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('stochastic')">
        <svg fill="currentColor" height="20" viewBox="0 0 24 24" width="20">
          <circle cx="5" cy="5" r="1.5"></circle>
          <circle cx="10" cy="12" r="2"></circle>
          <circle cx="15" cy="6" r="1"></circle>
          <circle cx="19" cy="14" r="1.8"></circle>
          <circle cx="7" cy="17" r="2.3"></circle>
        </svg>
        Semitono Avanzado
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('mejorar')">
        <svg class="feather feather-sun" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" x2="12" y1="1" y2="3"></line>
          <line x1="12" x2="12" y1="21" y2="23"></line>
          <line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
          <line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
          <line x1="1" x2="3" y1="12" y2="12"></line>
          <line x1="21" x2="23" y1="12" y2="12"></line>
          <line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
          <line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
        </svg>
        Mejorar Colores
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('calado')">
        <svg class="feather feather-droplet" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20">
          <path d="M12 2C12 2 4 10 4 16a8 8 0 0016 0c0-6-8-14-8-14z"></path>
        </svg>
        Calado Art√≠stico
      </a>

      <a class="flex items-center gap-2" href="#" onclick="mostrarTab('lamina')">
        <svg fill="currentColor" height="20" viewBox="0 0 24 24" width="20">
          <path d="M4 4h16v16H4z"></path>
        </svg>
        Generar L√°mina
      </a>

      <a class="flex items-center gap-2" href="contacto.html" target="_blank">
        <svg class="feather feather-mail" fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20">
          <path d="M4 4h16v16H4z"></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </svg>
        CONTACTO
      </a>
    </div>

    <!-- √Årea principal -->
    <div class="main-content">
      <main style="padding-top: 60px; font-family: sans-serif;"></main>
      <div id="usosRestantes" style="
            margin-bottom:20px;
            background:#1e1e1e;
            padding:15px;
            border-radius:10px;
            color:#00ffff;
            font-weight:bold;
            box-shadow:0 0 10px rgba(0,255,255,0.2);
          ">
        üîÑ Consultando tus usos restantes...
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ NUEVA SECCI√ìN: Generar L√°mina Progresivo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="tab-content" id="lamina">
        <h2>üîß Generar L√°mina Progresiva</h2>
        <p>Este recurso se encarga de leer todos los PNG de <code>img/</code>, empacar y generar las l√°minas.</p>
      
        <!-- Formulario desactivado -->
        <form id="formGenerarLamina" onsubmit="return false;">
          <input type="hidden" name="uid"    value="<?= htmlspecialchars($uid   ?? ''); ?>">
          <input type="hidden" name="email"  value="<?= htmlspecialchars($email ?? ''); ?>">
          <input type="hidden" name="nombre" value="<?= htmlspecialchars($nombre ?? ''); ?>">
      
          <button type="button"
                  disabled
                  title="Pr√≥ximamente disponible"
                  style="
                    background-color: #999;
                    color: #fff;
                    padding: 12px 24px;
                    border-radius: 8px;
                    font-weight: bold;
                    border: none;
                    cursor: not-allowed;
                    box-shadow: 0 0 10px rgba(100,100,100,0.5);
                    opacity: 0.6;
                  "
          >
            üöß Pr√≥ximamente
          </button>
        </form>
      </div>
      
      <!-- ‚îÄ‚îÄ‚îÄ FIN SECCI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

      <div class="tab-content" id="comprar">
        <h2 style="text-align: center; margin-bottom: 20px;">üí≥ Mi cuenta de Cr√©ditos</h2>
        <p style="text-align: center; margin-bottom: 30px;">Eleg√≠ un pack y pag√° con Mercado Pago o PayPal:</p>

        <div class="card-grid">
          <!-- Pack 10 -->
          <div class="card">
            <h2>üîü 10 Cr√©ditos</h2>
            <p>Ideal para pruebas y trabajos simples.</p>
            <button onclick="comprarCreditos(10)" style="
                width: 100%;
                padding: 12px;
                border-radius: 12px;
                font-weight: bold;
                color: #000;
                background: linear-gradient(120deg, #00c3ff, #00ffff);
                box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
                border: none;
                cursor: pointer;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
              " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 20px rgba(0,255,255,0.8)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 12px rgba(0,255,255,0.4)'">
              $900 ARS ‚Äì Mercado Pago
            </button>
            <div id="paypal-button-container-10" style="margin-top: 20px;"></div>
            <small style="color:#aaa; display:block; margin-top:10px;">USD 2.00 ‚Äì v√≠a PayPal</small>
          </div>

          <!-- Pack 150 -->
          <div class="card">
            <h2>üíØ 150 Cr√©ditos</h2>
            <p>Perfecto para producciones medianas.</p>
            <button onclick="comprarCreditos(150)" style="
                width: 100%;
                padding: 12px;
                border-radius: 12px;
                font-weight: bold;
                color: #000;
                background: linear-gradient(120deg, #00c3ff, #00ffff);
                box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
                border: none;
                cursor: pointer;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
              " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 20px rgba(0,255,255,0.8)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 12px rgba(0,255,255,0.4)'">
              $8750 ARS ‚Äì Mercado Pago
            </button>
            <div id="paypal-button-container-150" style="margin-top: 20px;"></div>
            <small style="color:#aaa; display:block; margin-top:10px;">USD 15.00 ‚Äì v√≠a PayPal</small>
          </div>

          <!-- Pack 500 -->
          <div class="card">
            <h2>üß† 500 Cr√©ditos</h2>
            <p>Recomendado para uso intensivo o equipos grandes.</p>
            <button onclick="comprarCreditos(500)" style="
                width: 100%;
                padding: 12px;
                border-radius: 12px;
                font-weight: bold;
                color: #000;
                background: linear-gradient(120deg, #00c3ff, #00ffff);
                box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
                border: none;
                cursor: pointer;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
              " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 20px rgba(0,255,255,0.8)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 12px rgba(0,255,255,0.4)'">
              $19500 ARS ‚Äì Mercado Pago
            </button>
            <div id="paypal-button-container-500" style="margin-top: 20px;"></div>
            <small style="color:#aaa; display:block; margin-top:10px;">USD 40.00 ‚Äì v√≠a PayPal</small>
          </div>
        </div>
      </div>

      <div class="tab-content active" id="ampliar">
        <h2>üîç Ampliar Imagen</h2>
        <form id="formAmpliar">
          <!-- Bot√≥n personalizado para seleccionar archivo -->
          <div class="input" style="position: relative;">
            <input accept=".png,.jpg,.jpeg" id="fileInputAmpliar" name="imagen" required style="opacity:0;position:absolute;left:0;top:0;width:100%;height:100%;cursor:pointer;" type="file" onchange="mostrarVistaPrevia(this)" />

            <button class="user-profile" onclick="document.getElementById('fileInputAmpliar').click()" type="button">
              <div class="user-profile-inner">
                üìÅ Seleccionar Imagen
              </div>
            </button>

            <!-- Contenedor para previsualizaci√≥n -->
            <div id="previewImagen" style="margin-top: 10px;"></div>
          </div>

          <script>
            function mostrarVistaPrevia(input) {
              const preview = document.getElementById("previewImagen");
              if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                  preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; border: 1px solid #ccc; border-radius: 8px; margin-top: 10px;" alt="Vista previa"/>`;
                };
                reader.readAsDataURL(input.files[0]);
              }
            }
          </script>

          <!-- Campo alto en cm -->
          <div class="input" style="position: relative;">
            <input id="alto_cm" max="100" name="alto_cm" oninput="validarAlto()" required="" step="0.1" type="number"/>
            <label>Alto en cm</label>
            <small id="errorAlto" style="color: #ff8080; display: none; position: absolute; top: 100%; left: 0; font-size: 0.8em;">
              ‚ö†Ô∏è El m√°ximo permitido es 100 cm para cuentas gratuitas.
            </small>
          </div>

          <!-- Campo DPI -->
          <div class="input">
            <input name="dpi" readonly="" type="number" value="300"/>
            <label>DPI</label>
          </div>

          <!-- Bot√≥n procesar -->
          <button class="user-profile" type="submit">
            <div class="user-profile-inner">
              Procesar Imagen
            </div>
          </button>
        </form>

        <div id="descargaAmplia">
          <p>‚úÖ Imagen procesada</p>
          <a download="" href="#" id="linkAmplia">‚¨áÔ∏è Descargar Imagen</a>
        </div>
      </div>

      <div class="tab-content" id="quitar">
        <h2>üí† Quitar Fondo</h2>

        <form id="formFondo">
          <!-- Selector de archivo invisible -->
          <div class="input" style="position: relative;">
            <input
              accept=".png,.jpg,.jpeg"
              id="fileInputQuitar"
              name="imagen"
              required
              style="opacity:0; position:absolute; left:0; top:0; width:100%; height:100%; cursor:pointer;"
              type="file"
              onchange="mostrarPreviews(this)"
            />
            <button
              class="user-profile"
              type="button"
              onclick="document.getElementById('fileInputQuitar').click()"
            >
              <div class="user-profile-inner">üìÅ Seleccionar Imagen</div>
            </button>
          </div>

          <!-- Bot√≥n procesar -->
          <button class="user-profile" type="submit">
            <div class="user-profile-inner">Quitar Fondo</div>
          </button>
        </form>

        <!-- Contenedor vistas previa -->
        <div id="previewContainer" style="display:flex; gap:20px; margin-top:20px; flex-wrap:wrap;">
          <!-- Antes -->
          <div style="flex:1; min-width:120px; text-align:center;">
            <h3>Antes</h3>
            <div
              id="previewAntes"
              style="height:200px; border:2px dashed #555; padding:10px; border-radius:8px; display:flex; align-items:center; justify-content:center;"
            >
              <p style="color:#888;">Sin imagen</p>
            </div>
          </div>

          <!-- Despu√©s -->
          <div style="flex:1; min-width:120px; text-align:center;">
            <h3>Despu√©s</h3>
            <div
              id="previewDespues"
              style="height:200px; border:2px dashed #555; padding:10px; border-radius:8px; display:flex; align-items:center; justify-content:center;"
            >
              <p style="color:#888;">Sin procesar</p>
            </div>
          </div>
        </div>

        <!-- Descarga -->
        <div id="descargaFondo" style="margin-top:20px; display:none; text-align:center;">
          <p>‚úÖ Imagen procesada</p>
          <a download id="linkFondo" href="#">‚¨áÔ∏è Descargar Sin Fondo</a>
        </div>
      </div>

      <script>
        function mostrarPreviews(input) {
          const antes = document.getElementById("previewAntes");
          const despues = document.getElementById("previewDespues");
          antes.innerHTML = '';
          despues.innerHTML = '<p style="color:#888;">Sin procesar</p>';
          document.getElementById("descargaFondo").style.display = "none";

          if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
              antes.innerHTML = `<img src="${e.target.result}" style="max-width:100%; max-height:100%; border-radius:4px;" alt="Antes"/>`;
            };
            reader.readAsDataURL(input.files[0]);
          } else {
            antes.innerHTML = '<p style="color:#888;">Sin imagen</p>';
          }
        }

        document.getElementById("formFondo").addEventListener("submit", async e => {
          e.preventDefault();
          const fileInput = document.getElementById("fileInputQuitar");
          if (!fileInput.files.length) return;

          // Prepara formulario
          const form = new FormData();
          form.append("imagen", fileInput.files[0]);

          // Env√≠a a tu endpoint PHP
          const res = await fetch("quitarfondo.php", {
            method: "POST",
            body: form
          });

          if (!res.ok) {
            alert("Error al procesar la imagen.");
            return;
          }

          const filename = await res.text();
          const url = `/outputs/${filename}`;

          // Mostrar ‚ÄúDespu√©s‚Äù
          const despues = document.getElementById("previewDespues");
          despues.innerHTML = `<img src="${url}" style="max-width:100%; max-height:100%; border-radius:4px;" alt="Despu√©s"/>`;

          // Habilitar descarga
          const link = document.getElementById("linkFondo");
          link.href = url;
          document.getElementById("descargaFondo").style.display = "block";
        });
      </script>

      <div class="tab-content" id="quitarAdv">
        <h2>üõ†Ô∏è Quitar Fondo Avanzado</h2>
        <form id="formFondoAdv">
          <!-- Bot√≥n personalizado para seleccionar archivo -->
          <div class="input" style="position: relative;">
            <input accept=".png,.jpg,.jpeg" id="fileInputAdv" name="imagen" required="" style="opacity:0;position:absolute;left:0;top:0;width:100%;height:100%;cursor:pointer;" type="file"/>
            <button class="user-profile" onclick="document.getElementById('fileInputAdv').click()" type="button">
              <div class="user-profile-inner">üìÅ Seleccionar Imagen</div>
            </button>
          </div>
          <!-- FG Threshold -->
          <label>FG Threshold: <span id="fgVal">240</span></label>
          <input id="fg_thresh" max="255" min="200" name="fg_thresh" type="range" value="240"/>
          <small class="help-text">
            Controla cu√°nta parte del sujeto consideramos ‚Äúprimer plano‚Äù seguro.
            <br/>‚Ü≥ Valores altos (240‚Äì255): retienen m√°s detalles finos (cabello, reflejos) incluso si son oscuros.
            <br/>‚Ü≥ Valores bajos (200‚Äì239): matizan m√°s agresivo y pueden ‚Äúafeitar‚Äù un poco el borde.
          </small>
          <!-- BG Threshold -->
          <label>BG Threshold: <span id="bgVal">15</span></label>
          <input id="bg_thresh" max="60" min="0" name="bg_thresh" type="range" value="15"/>
          <small class="help-text">
            Define qu√© tan estricto es al eliminar el fondo oscuro.
            <br/>‚Ü≥ Valores altos (30‚Äì60): elimina incluso sombras o zonas oscuras no deseadas.
            <br/>‚Ü≥ Valores bajos (0‚Äì14): solo quita el negro puro, conserva sombras suaves del sujeto.
          </small>
          <!-- Erode Size -->
          <label>Erode size: <span id="erodeVal">5</span> px</label>
          <input id="erode" max="20" min="0" name="erode" type="range" value="5"/>
          <small class="help-text">
            Ajusta el ancho de la ‚Äúzona gris‚Äù de transici√≥n antes del matting.
            <br/>‚Ü≥ Valores altos (8‚Äì20): transici√≥n m√°s suave, menos halos pero m√°s √°rea de difuminado.
            <br/>‚Ü≥ Valores bajos (0‚Äì4): recorte m√°s cercano al borde real, pero puede dejar artefactos.
          </small>
          <!-- Protect Dilate -->
          <label>Protect Dilate: <span id="dilateVal">0</span> px</label>
          <input id="dilate" max="20" min="0" name="dilate" type="range" value="0"/>
          <small class="help-text">
            Expande la m√°scara de primer plano para ‚Äúproteger‚Äù el sujeto.
            <br/>‚Ü≥ Valores altos (5‚Äì20): crea un margen seguro, nada se recorta dentro de X p√≠xeles.
            <br/>‚Ü≥ Valor 0: sin protecci√≥n extra, bordes tal cual el matting los defina.
          </small>
          <button class="user-profile" type="submit">
            <div class="user-profile-inner">Quitar Fondo Avanzado</div>
          </button>
        </form>
        <div id="descargaFondoAdv" style="display:none; margin-top:20px;">
          <p>‚úÖ Imagen procesada</p>
          <a download="" href="#" id="linkFondoAdv">‚¨áÔ∏è Descargar PNG</a>
        </div>
        <div class="text-center mt-8">
          <a class="inline-block bg-gradient-to-r from-purple-600 via-pink-500 to-cyan-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:scale-105 transition-transform duration-300" href="http://pigmentalab.io:8080/quitarfondoadv.html" target="_blank">
            üìò Ver c√≥mo usar cada par√°metro
          </a>
        </div>
      </div>

      <script>
        // Mostrar valor en etiquetas al mover sliders
        ['fg_thresh','bg_thresh','erode','dilate'].forEach(id => {
          const inp = document.getElementById(id);
          const label = document.getElementById(id.replace('_thresh','') + 'Val');
          inp.addEventListener('input', () => label.innerText = inp.value);
        });
      </script>

      <div class="tab-content" id="halftone">
        <h2 class="text-xl font-bold text-white mb-6">üñ§ Semitono</h2>
        <form class="space-y-6" id="formHalftone">
          <!-- Selector de imagen -->
          <div class="relative">
            <input accept=".png,.jpg,.jpeg" class="sr-only" id="fileInputHalftone" name="imagen" required="" type="file"/>
            <button class="user-profile w-full" onclick="document.getElementById('fileInputHalftone').click()" type="button">
              <div class="user-profile-inner" id="fileLabelHalftone">üìÅ Seleccionar Imagen</div>
            </button>
          </div>
          <!-- Separaci√≥n entre puntos -->
          <div class="relative">
            <input class="w-full px-4 py-3 bg-gray-800 border border-purple-500 rounded-lg text-white placeholder-transparent focus:outline-none focus:ring-2 focus:ring-cyan-400" id="dot_spacing" max="100" min="4" name="dot_spacing" placeholder="Separaci√≥n entre puntos" required="" type="number" value="12"/>
            <label class="absolute left-4 top-3 text-gray-400 text-sm transition-all peer-placeholder-shown:top-3 peer-focus:top-[-10px] peer-focus:text-xs peer-focus:text-cyan-300" for="dot_spacing">
              Separaci√≥n entre puntos
            </label>
          </div>
          <!-- Tama√±o m√°ximo del punto -->
          <div class="relative">
            <input class="w-full px-4 py-3 bg-gray-800 border border-purple-500 rounded-lg text-white placeholder-transparent focus:outline-none focus:ring-2 focus:ring-cyan-400" id="max_radius" max="100" min="4" name="max_radius" placeholder="Tama√±o m√°ximo del punto" required="" type="number" value="6"/>
            <label class="absolute left-4 top-3 text-gray-400 text-sm transition-all peer-placeholder-shown:top-3 peer-focus:top-[-10px] peer-focus:text-xs peer-focus:text-cyan-300" for="max_radius">
              Tama√±o m√°ximo del punto
            </label>
          </div>
          <!-- Forma del punto -->
          <div class="relative">
            <label class="block text-sm text-gray-300 mb-1" for="forma">Forma del punto</label>
            <select class="w-full px-4 py-3 bg-gray-800 border border-purple-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-cyan-400" id="forma" name="forma">
              <option value="circulo">üîµ C√≠rculo</option>
              <option value="cuadrado">‚¨õ Cuadrado</option>
              <option value="cruz">‚ûï Cruz</option>
              <option value="estrella">‚ú¥ Estrella</option>
              <option value="rombo">‚óÜ Rombo</option>
              <option value="hexagono">‚¨° Hex√°gono</option>
              <option value="anillo">‚≠ï Anillo</option>
            </select>
          </div>
          <!-- Bot√≥n de procesar -->
          <button class="user-profile w-full" type="submit">
            <div class="user-profile-inner">üé® Crear Semitono</div>
          </button>
        </form>
        <div class="mt-6" id="descargaHalftone">
          <p>‚úÖ Imagen procesada</p>
          <a class="text-cyan-300 underline" download="" href="#" id="linkHalftone">‚¨áÔ∏è Descargar Halftone</a>
        </div>
      </div>

      <div class="tab-content" id="stochastic">
        <h2>üé≤ Semitono Avanzado (Stochastic)</h2>
        <form id="formStochastic" style="display: flex; flex-direction: column; gap: 14px;">
          <label>
            üìÅ <strong>Seleccion√° una imagen</strong><br/>
            <input accept=".png,.jpg,.jpeg" name="imagen" required="" style="margin-top: 6px;" type="file"/>
          </label>
          <label>üü¶ <strong>Separaci√≥n entre puntos</strong><br/>
            <input max="100" min="1" name="cell_size" type="number" value="12"/>
            <small style="color:#888">Ej: 8 = puntos m√°s juntos, 20 = puntos m√°s separados</small>
          </label>
          <label>‚¨§ <strong>Tama√±o m√°ximo del punto</strong><br/>
            <input max="100" min="1" name="max_radius" type="number" value="6"/>
            <small style="color:#888">Ej: 3 = puntos chicos, 10 = c√≠rculos grandes en zonas oscuras</small>
          </label>
          <label>üéöÔ∏è <strong>Contraste (exponente)</strong><br/>
            <input max="2" min="0.1" name="exponent" step="0.1" type="number" value="0.5"/>
            <small style="color:#888">Ej: 0.3 = m√°s contraste visual; 1.5 = distribuci√≥n m√°s suave</small>
          </label>
          <label>üìê <strong>√Ångulo de rotaci√≥n</strong><br/>
            <input max="180" min="0" name="angle" type="number" value="45"/>
            <small style="color:#888">Ej: 0¬∞ = horizontal, 45¬∞ = en diagonal</small>
          </label>
          <label>üîÜ <strong>Gamma</strong><br/>
            <input max="5" min="0.1" name="gamma" step="0.1" type="number" value="2.2"/>
            <small style="color:#888">Ej: 1.0 = imagen m√°s clara, 3.0 = m√°s oscura antes de tramar</small>
          </label>
          <label>üå´ <strong>Desenfoque (blur)</strong><br/>
            <input max="5" min="0" name="blur" step="0.1" type="number" value="0.8"/>
            <small style="color:#888">Ej: 0.0 = n√≠tido, 2.0 = bordes m√°s suaves</small>
          </label>
          <label>üé≤ <strong>Variaci√≥n de posici√≥n (jitter)</strong><br/>
            <input max="1" min="0" name="jitter_pos" step="0.05" type="number" value="0.25"/>
            <small style="color:#888">Ej: 0.0 = puntos ordenados, 0.5 = puntos m√°s dispersos</small>
          </label>
          <label>üé≤ <strong>Variaci√≥n de tama√±o</strong><br/>
            <input max="1" min="0" name="jitter_size" step="0.05" type="number" value="0.15"/>
            <small style="color:#888">Ej: 0.0 = todos iguales, 0.3 = tama√±os irregulares</small>
          </label>
          <button type="submit">üé® Generar semitono disperso</button>
        </form>
        <div id="descargaStochastic" style="display:none; margin-top:1em">
          <p>‚úÖ Semitono disperso generado correctamente</p>
          <a download="" href="#" id="linkStochastic">‚¨áÔ∏è Descargar Imagen</a>
        </div>
        <p style="margin-top:2em; text-align:center; font-size:0.9em;">
          ‚ùì ¬øQuer√©s aprender c√≥mo funciona cada opci√≥n?<br/>
          <a href="http://pigmentalab.io:8080/semitonos_adv.html" style="color:#0ff; text-decoration:underline;" target="_blank">
            Ver explicaci√≥n detallada del Semitono Avanzado
          </a>
        </p>
      </div>

      <div class="tab-content" id="mejorar">
        <h2>üé® Mejorar Colores</h2>
        <form id="formMejorar">
          <input accept=".png,.jpg,.jpeg" name="imagen" required="" type="file"/>
          <label>Tipo de mejora:</label>
          <select name="modo">
            <option value="inteligente">üß† Mejora Inteligente</option>
            <option value="negra">üñ§ Prenda Negra</option>
            <option value="blanca">ü§ç Prenda Blanca</option>
          </select>
          <button class="user-profile" type="submit">
            <div class="user-profile-inner">Mejorar</div>
          </button>
        </form>
        <div id="descargaMejorada">
          <p>‚úÖ Imagen mejorada</p>
          <a download="" href="#" id="linkMejorada">‚¨áÔ∏è Descargar Imagen Mejorada</a>
        </div>
      </div>

      <div class="tab-content" id="calado">
        <h2>üåë Calado Art√≠stico</h2>
        <form id="formCalado">
          <input accept=".png,.jpg,.jpeg" name="imagen" required="" type="file"/>
          <label>Nivel de umbral:</label>
          <input max="255" min="0" name="threshold" type="number" value="60"/>
          <button class="user-profile" type="submit">
            <div class="user-profile-inner">Aplicar</div>
          </button>
        </form>
        <div id="descargaCalado">
          <p>‚úÖ Imagen procesada</p>
          <a download="" href="#" id="linkCalado">‚¨áÔ∏è Descargar Imagen Calada</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Loader -->
  <div id="loaderOverlay">
    <div class="loader"></div>
    <div id="loaderText">Procesando imagen...</div>
  </div>

  <script>
    // Overlay m√≥vil
    (function(){
      const esMovil = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      if (esMovil) {
        alert("üíª Te Recomendamos usar Pigmenta Lab en computadora. Pod√©s continuar igual üëç, pero algunas funciones pueden no estar optimizadas al 100%.");
      }
    })();

    // UI Helpers
    function mostrarTab(tab) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
    }
    function mostrarLoader(on) {
      document.getElementById('loaderOverlay').style.display = on ? 'flex' : 'none';
    }

    // Actualizar etiquetas de sliders en el formulario avanzado
    ['fg_thresh','bg_thresh','erode','dilate'].forEach(id => {
      const slider = document.getElementById(id);
      const label  = document.getElementById(id + 'Val');
      if (slider && label) {
        slider.addEventListener('input', () => { label.innerText = slider.value; });
      }
    });

    // Control de usos y autenticaci√≥n mejorado
    firebase.auth().onAuthStateChanged(user => {
      if (!user) return;

      // 1) Traer usos al iniciar
      actualizarCreditos(user.email);

      // 2) Asociar submit a cada formulario
      const forms       = ['formAmpliar','formFondo','formFondoAdv','formHalftone','formMejorar','formCalado','formStochastic'];
      const endpointMap = {
        formAmpliar:   'procesar.php',
        formFondo:     'quitarfondo.php',
        formFondoAdv:  'quitarfondo_advanced.php',
        formHalftone:  'halftone.php',
        formMejorar:   'color.php',
        formCalado:    'calado.php',
        formStochastic:'halftone_stochastic.php'
      };
      const salidaMap = {
        formAmpliar:   ['descargaAmplia','linkAmplia',''],
        formFondo:     ['descargaFondo','linkFondo','outputs/'],
        formFondoAdv:  ['descargaFondoAdv','linkFondoAdv','outputs/'],
        formHalftone:  ['descargaHalftone','linkHalftone',''],
        formMejorar:   ['descargaMejorada','linkMejorada',''],
        formCalado:    ['descargaCalado','linkCalado','/'],
        formStochastic:['descargaStochastic','linkStochastic','']
      };

      forms.forEach(id => {
        const form = document.getElementById(id);
        form.addEventListener('submit', async e => {
          e.preventDefault();
          if (creditosDisponibles <= 0) {
            return alert('‚ùå No ten√©s cr√©ditos suficientes. Compr√° m√°s cr√©ditos para continuar.');
          }

          // Preparar request
          const fd      = new FormData(form);
          fd.append('uid',    user.uid);
          fd.append('email',  user.email);
          fd.append('nombre', user.displayName || 'Sin Nombre');

          const [contID, linkID, basePath] = salidaMap[id];
          const endpoint                 = endpointMap[id];

          const btn     = form.querySelector('button');
          const origTxt = btn.innerText;
          btn.disabled  = true;
          btn.innerText = '‚è≥ Procesando...';
          mostrarLoader(true);

          try {
            const res      = await fetch(endpoint, { method: 'POST', body: fd });
            if (!res.ok) throw new Error(await res.text());
            const filename = (await res.text()).trim();
            document.getElementById(contID).style.display = 'block';
            document.getElementById(linkID).href = basePath + filename;

            const data = new FormData();
            data.append('email', user.email);

            await fetch('descontar_credito.php', { method: 'POST', body: data })
              .then(r => r.json())
              .then(res => {
                if (res.success) {
                  creditosDisponibles--;
                  mostrarCreditos();
                } else {
                  alert('‚ö†Ô∏è No se pudo descontar el cr√©dito: ' + res.mensaje);
                }
              });
          } catch (err) {
            alert('‚ùå ' + err.message);
          } finally {
            btn.disabled  = false;
            btn.innerText = origTxt;
            mostrarLoader(false);
          }
        });
      });
    });

    // Recomendaci√≥n autom√°tica para el semitono
    document.querySelector('#formHalftone input[type="file"]').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        const img = new Image();
        img.onload = () => {
          const dpi      = 300;
          const ancho_cm = (img.width / dpi) * 2.54;
          const alto_cm  = (img.height / dpi) * 2.54;
          const area     = ancho_cm * alto_cm;
          let spacing = 12, radius = 4;
          if (area < 200)      { spacing = 4;  radius = 1; }
          else if (area < 600) { spacing = 8;  radius = 3; }
          document.querySelector('[name="dot_spacing"]').value = spacing;
          document.querySelector('[name="max_radius"]').value  = radius;
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });
  </script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      background: #000000;
      --gap: 5em;
      --line: 1px;
      --color: rgba(255, 255, 255, 0.2);

      background-image:
        linear-gradient(-90deg,
          transparent calc(var(--gap) - var(--line)),
          var(--color) calc(var(--gap) - var(--line) + 1px),
          var(--color) var(--gap)
        ),
        linear-gradient(0deg,
          transparent calc(var(--gap) - var(--line)),
          var(--color) calc(var(--gap) - var(--line) + 1px),
          var(--color) var(--gap)
        );
      background-size: var(--gap) var(--gap);
    }
  </style>

  <script>
    // ‚Äî 1) Variables globales ‚Äî
    let usosRestantes = 0;
    let usosLimite    = 0;

    // ‚Äî 2) Pinta el contador en pantalla ‚Äî
    function mostrarUsos() {
      const el = document.getElementById('usosRestantes');
      el.innerText = `üîÑ Usos restantes hoy: ${usosRestantes}/${usosLimite}`;
    }

    // ‚Äî 3) Llama al PHP y actualiza las variables ‚Äî
    let creditosDisponibles = 0;

    function mostrarCreditos() {
      const el = document.getElementById('usosRestantes');
      el.innerText = `üí≥ Cr√©ditos disponibles: ${creditosDisponibles}`;
    }

    function actualizarCreditos(email) {
      const fd = new FormData();
      fd.append('email', email);

      fetch('consultar_creditos.php', {
        method: 'POST',
        body: fd
      })
      .then(r => r.json())
      .then(d => {
        creditosDisponibles = d.creditos ?? 0;
        mostrarCreditos();
      })
      .catch(err => {
        console.error('Error al consultar cr√©ditos:', err);
        document.getElementById('usosRestantes').innerText = '‚ö†Ô∏è Error al consultar cr√©ditos';
      });
    }

    // ‚Äî 4) Arranca cuando Firebase Auth est√© listo ‚Äî
    document.addEventListener('DOMContentLoaded', () => {
      const out = document.getElementById('usosRestantes');

      firebase.auth().onAuthStateChanged(user => {
        if (!user) {
          out.innerText = '‚ö†Ô∏è Inicia sesi√≥n para ver tus usos';
          return;
        }
        // Ya hay usuario ‚Üí pedimos los usos al backend
        actualizarCreditos(user.email);
      });
    });
  </script>

  <script async defer src="https://tools.luckyorange.com/core/lo.js?site-id=9f9e23e5"></script>
  <!-- Hotjar Tracking Code for PigmentaLab -->
  <script>
    (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:6415165,hjsv:6};
      a=o.getElementsByTagName('head')[0];
      r=o.createElement('script');r.async=1;
      r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
      a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
 </body>
</html>
